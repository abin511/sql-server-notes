--SQL2008增加了对表值函数的联接支持
--CROSS APPLY: 如果右侧表源为左边表源列提供参数值，只返回行集
--OUTER APPLY: 就像一个外部联接，即使右表没有行集返回，也至少返回左边表源的一行

--与派生表联接
SELECT * FROM TABLE_1 X CROSS APPLY ( SELECT * FROM TABLE_1 WHERE ID < 3 ) Y
SELECT * FROM TABLE_1 X OUTER APPLY ( SELECT * FROM TABLE_1 WHERE ID < 3 ) Y

--与表值函数联接
CREATE FUNCTION TMPFUNC()
RETURNS @OUTPUT TABLE(GOODS MONEY)
AS
BEGIN
	INSERT INTO @OUTPUT SELECT GOODS FROM TABLE_1 WHERE ID < 3
	RETURN
END
GO
SELECT * FROM TABLE_1 X CROSS APPLY DBO.TMPFUNC() Y
GO
IF OBJECT_ID('TMPFUNC') IS NOT NULL
	DROP FUNCTION TMPFUNC
GO